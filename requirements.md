要件定義：IoTエネマネ機器群エミュレータ
1. プロジェクト概要
ECHONET Lite最新規格に準拠した、家庭内のエネルギーマネジメント機器（スマートメーター、太陽光発電、蓄電池）のエミュレータを構築する。QA担当者が、実機がない環境でもコントローラー（HEMS等）の評価を行えるよう、動的な電力収支計算とGUIによる操作、シナリオ実行機能を提供する。
2. システム構成・動作環境
2.1 実行環境
* プラットフォーム: Raspberry Pi (OS: Raspberry Pi OS) および Ubuntu (開発用)
* 移植性: Docker Compose を活用し、両環境で同一の動作を保証する。
* デバイス管理: Wi-SUNドングルのパス（例: /dev/ttyUSB0）を環境変数から指定可能とする。
2.2 通信インターフェース
* Wi-SUN (Bルート): 低圧スマートメーター (0x0288) 専用。PANA認証を実装する。
* Wi-Fi (UDP/IP): 太陽光発電 (0x0279) および 蓄電池 (0x027D) 用。
  * マルチオブジェクト構成: 1つのIPアドレス（ポート3610）上で複数の機器インスタンスを公開する。
* エラーハンドリング: ドングル未接続や認証エラー時はリトライせず、エラー停止（Fail-fast）とする。
3. シミュレーションロジック（Core Engine）
3.1 電力収支計算
以下の計算式に基づき、各機器の瞬時電力値（W）をリアルタイムに同期させる。
$$P_{grid} = (P_{load} + P_{charge}) - (P_{solar} + P_{discharge})$$
* $P_{grid}$: スマートメーター計測値（買電：正 / 売電：負）
* $P_{load}$: 家庭内負荷（シナリオに準拠）
* $P_{solar}$: 太陽光発電量（定格出力およびシナリオに準拠）
* $P_{charge} / P_{discharge}$: 蓄電池充放電（コントローラーからの指示および定格に準拠）
3.2 物理的制約（ガードロジック）
* SOCガード: 蓄電残量(SOC)が0%の場合は放電不可、100%の場合は充電不可とする。
* 定格制限: 各機器に設定された最大出力を超える値は、定格値でクリップする。
* 積算計算: 瞬時値から積算電力量（kWh）を自動算出し保持する。
4. 機能要件
4.1 シナリオ実行
* 1日分シナリオ: 24時間の時系列データ（時刻ごとの負荷・天候等）をCSV等で読み込み、実時刻に合わせて自動実行する。
* 動的更新: シナリオ走行中でも、GUIからの手動操作やコントローラーからの制御命令を即座に優先反映する。
4.2 ECHONET Lite 準拠
* 最新規格: 開発時点での最新の規格書および機器オブジェクト詳細規定に準拠する。
* 必須プロパティ: 各機器クラスの必須プロパティをすべて実装する。
4.3 GUI (Web Interface)
* 可視化: 家庭内の電力フローをリアルタイムでアニメーション表示する。
* 設定機能:
  * Wi-SUNのPANA ID、パスワード、ドングルパスの設定。
  * 各機器のECHONET Liteパラメータ（初期値）の設定。
* 永続化: GUIから変更した初期値や積算値、設定内容は設定ファイルへ保存し、再起動時に復元する。
5. 推奨技術
* スタック言語: Python 3.10+
* バックエンド: FastAPI (ECHONET Liteスタックとの非同期連携)
* フロントエンド: NiceGUI (またはStreamlit)
* コンテナ化: Docker, Docker Compose

